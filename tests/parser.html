<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="../js/decl.js"></script>
    <script type="text/javascript" src="../js/decl/expression.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <link rel="stylesheet" href="list.css">
    <title>parse me, link me, be happy!</title>
</head>
<body>
<pre>
    open console
</pre>
<script type="text/javascript">
var data = {
    name: "Joe",
    user: {
        name: "John Doe",
        bar: {
            arr: ["one", "two", "three"],
            obj: { foo: "bar" },
            fun: function(arg1, arg2) { return ["fun-function", arg1, arg2].join(","); },
            i: 42,
            str: "a string"
        }
    },
    fun: function(arg) { return "["+arg+"]";},
    time: function() {
        if (this.update) setInterval(this.update, 3000);
        return +new Date();
    }
};

function execute(expr, data) {
    var e = new Expression(expr);
    var eb = e(data, function(value) {
        console.log("~ execute.onUpdate:", '"' + expr + '"'," ==> ", "" + value);
    });
//    console.log("~ execute:", '"' + expr + '"',"==>", eb, eb.exec());
}

execute("42", data);
//execute("user.name | arg(name)", data);
//execute("'user.name'", data);
//execute('"Hello $ and $!" | upper | arg(name) | arg(user.name, 42, fun("42"))', data);
//execute('fun(fun("poohh")) | upper', data);
//execute('time()', data);
execute('user.bar.obj|json', data);
execute('["foo", user.bar["str"]|upper]', data);
execute('["foo", "str"][2]', data);
</script>
</body>
</html>
